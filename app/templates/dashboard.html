<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard â€” ResumeForge</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Inter', sans-serif; background: #f8fafc; color: var(--rf-text); }
    .dash-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0.75rem 1.5rem; background: #fff; border-bottom: 1px solid var(--rf-border);
    }
    .dash-logo {
      display: flex; align-items: center; gap: 0.5rem;
      font-weight: 700; font-size: 1.1rem; text-decoration: none; color: var(--rf-dark);
    }
    .dash-logo span:last-child { color: var(--rf-primary); }
    .dash-nav { display: flex; align-items: center; gap: 1.5rem; }
    .dash-nav a { color: var(--rf-muted); text-decoration: none; font-weight: 500; font-size: 0.9rem; }
    .dash-nav a:hover { color: var(--rf-primary); }
    .dash-user-wrap { position: relative; }
    .dash-user-btn {
      display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0.6rem;
      background: none; border: none; cursor: pointer; font-family: inherit; font-size: 0.9rem;
      font-weight: 600; color: var(--rf-text); border-radius: 8px;
    }
    .dash-user-btn:hover { background: #f1f5f9; }
    .dash-user-btn svg { transition: transform 0.2s; }
    .dash-user-wrap.open .dash-user-btn svg { transform: rotate(180deg); }
    .dash-user-avatar {
      width: 28px; height: 28px; border-radius: 50%; object-fit: cover;
      background: var(--rf-primary-light); color: var(--rf-primary);
    }
    .dash-dropdown {
      display: none; position: absolute; top: 100%; right: 0; margin-top: 0.25rem;
      min-width: 160px; background: #fff; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.12);
      border: 1px solid var(--rf-border); padding: 0.5rem; z-index: 100;
    }
    .dash-user-wrap.open .dash-dropdown { display: block; }
    .dash-dropdown a {
      display: block; padding: 0.6rem 0.75rem; color: var(--rf-text); text-decoration: none;
      font-size: 0.9rem; border-radius: 6px;
    }
    .dash-dropdown a:hover { background: #f1f5f9; }
    .dash-dropdown .logout { color: #dc2626; }
    .dash-dropdown .logout:hover { background: #fef2f2; }
    .dash-main { display: flex; gap: 1.5rem; max-width: 1400px; margin: 0 auto; padding: 1.5rem; }
    .dash-left { flex: 0 0 auto; }
    .dash-right { flex: 1; min-width: 400px; max-width: 480px; }
    .dash-card {
      background: #fff; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      border: 1px solid var(--rf-border); overflow: hidden;
    }
    .dash-resume-card { width: fit-content; }
    .dash-resume-header {
      padding: 0.6rem 1rem; border-bottom: 1px solid var(--rf-border);
      display: flex; align-items: center; justify-content: space-between; gap: 0.75rem;
    }
    .dash-resume-filename {
      font-weight: 600; font-size: 0.9rem; color: var(--rf-dark);
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
    }
    .dash-resume-select {
      font-size: 0.8rem; padding: 0.35rem 0.6rem; border-radius: 6px;
      border: 1px solid var(--rf-border); background: #fff; color: var(--rf-text);
      font-family: inherit; cursor: pointer; max-width: 200px;
    }
    .dash-resume-select:focus { outline: none; border-color: var(--rf-primary); }
    .dash-preview-wrap {
      position: relative; overflow: hidden; background: #e2e8f0;
      width: 250px; aspect-ratio: 595 / 842;
    }
    .dash-preview-scaler {
      position: absolute; left: 50%; top: 0;
      width: 595px; height: 842px;
      transform: translateX(-50%) scale(0.42);
      transform-origin: top center;
    }
    .dash-preview-iframe {
      width: 595px; height: 842px; border: none; display: block;
      background: #fff; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .dash-actions {
      padding: 0.6rem 1rem; display: flex; align-items: center; gap: 0.5rem;
      border-top: 1px solid var(--rf-border);
    }
    .dash-btn-icon {
      display: inline-flex; align-items: center; justify-content: center;
      width: 32px; height: 32px; border-radius: 8px;
      color: var(--rf-text); text-decoration: none; transition: all 0.2s;
      border: 1px solid var(--rf-border); background: #fff;
    }
    .dash-btn-icon:hover { background: #f1f5f9; border-color: var(--rf-primary); color: var(--rf-primary); }
    .dash-btn-icon svg { width: 16px; height: 16px; }
    .dash-btn-outline {
      display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.4rem 0.75rem;
      border-radius: 8px; font-weight: 600; font-size: 0.8rem; text-decoration: none;
      font-family: inherit; color: var(--rf-primary); border: 1px solid var(--rf-primary);
      background: #fff; margin-left: auto;
    }
    .dash-btn-outline:hover { background: var(--rf-primary-light); }
    .dash-checklist-title { font-weight: 700; font-size: 1.1rem; padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--rf-border); }
    .dash-checklist-item {
      padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--rf-border);
    }
    .dash-checklist-item:last-child { border-bottom: none; }
    .dash-checklist-item h4 { font-size: 1rem; margin: 0 0 0.5rem 0; font-weight: 600; }
    .dash-checklist-item p { font-size: 0.9rem; color: var(--rf-muted); margin: 0; line-height: 1.45; }
    .dash-checklist-item a { font-size: 0.95rem; font-weight: 600; color: var(--rf-primary); text-decoration: none; margin-top: 0.6rem; display: inline-block; }
    .dash-checklist-item a:hover { text-decoration: underline; }
    .dash-empty { text-align: center; padding: 3rem 2rem; color: var(--rf-muted); }
    .dash-empty h3 { font-size: 1.1rem; color: var(--rf-text); margin-bottom: 0.5rem; }
  </style>
</head>
<body>

<header class="dash-header">
  <a href="/" class="dash-logo">
    <span>Resume</span><span>Forge</span>
  </a>
  <nav class="dash-nav">
    <a href="/templates">Templates</a>
    <a href="/editor">Editor</a>
  </nav>
  <div class="dash-user-wrap" id="userDropdown">
    <button type="button" class="dash-user-btn" aria-expanded="false" aria-haspopup="true">
      {% if user.avatar_url %}
      <img src="{{ user.avatar_url }}" alt="" class="dash-user-avatar">
      {% else %}
      <div class="dash-user-avatar" style="display:flex;align-items:center;justify-content:center;font-size:0.75rem;">{{ user.display_name[0]|upper }}</div>
      {% endif %}
      <span>{{ user.display_name|upper }}</span>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
    </button>
    <div class="dash-dropdown">
      <a href="/editor">Edit Resume</a>
      <a href="/auth/logout" class="logout">Log out</a>
    </div>
  </div>
</header>

<main class="dash-main">
  <div class="dash-left">
    <div class="dash-card dash-resume-card">
      <div class="dash-resume-header">
        <span class="dash-resume-filename">{{ display_name(current_resume) if current_resume else 'MY_RESUME' }}</span>
        {% if resumes|length > 1 %}
        <select class="dash-resume-select" id="resumeSelect" onchange="if(this.value) location.href='?resume_id='+this.value">
          {% for r in resumes %}
          <option value="{{ r.id }}" {{ 'selected' if current_resume and r.id == current_resume.id else '' }}>{{ display_name(r) }}</option>
          {% endfor %}
        </select>
        {% endif %}
      </div>
      <div class="dash-preview-wrap">
        <script type="text/html" id="resume-preview-html">{{ resume_html|safe }}</script>
        <div class="dash-preview-scaler">
          <iframe class="dash-preview-iframe" id="resume-preview-iframe" title="Resume preview" sandbox="allow-same-origin"></iframe>
        </div>
      </div>
      <div class="dash-actions">
        <a href="/editor{{ '?resume_id=' ~ current_resume.id if current_resume else '' }}" class="dash-btn-icon" title="Edit resume">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        </a>
        <a href="/template-editor{{ '?resume_id=' ~ current_resume.id if current_resume else '' }}" class="dash-btn-icon" title="Download PDF">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        </a>
        <a href="/templates" class="dash-btn-outline">+ Create New Resume</a>
      </div>
    </div>
  </div>
  <aside class="dash-right">
    <div class="dash-card">
      <div class="dash-checklist-title">Your Checklist</div>
      <div class="dash-checklist-item">
        <h4>Get your resume</h4>
        <p>Your resume is ready to download.</p>
        <a href="/template-editor">Download resume</a>
      </div>
      <div class="dash-checklist-item">
        <h4>Improve your resume</h4>
        <p>Add more details to strengthen your resume.</p>
        <a href="/editor">Edit resume</a>
      </div>
      <div class="dash-checklist-item">
        <h4>Create a cover letter</h4>
        <p>Pair your resume with a matching cover letter.</p>
        <a href="/templates">Create cover letter</a>
      </div>
    </div>
  </aside>
</main>

<script>
(function() {
  const wrap = document.getElementById('userDropdown');
  const btn = wrap.querySelector('.dash-user-btn');
  btn.addEventListener('click', function(e) {
    e.stopPropagation();
    wrap.classList.toggle('open');
  });
  document.addEventListener('click', function() {
    wrap.classList.remove('open');
  });

  const htmlEl = document.getElementById('resume-preview-html');
  const iframe = document.getElementById('resume-preview-iframe');
  if (htmlEl && iframe) {
    iframe.srcdoc = htmlEl.textContent;
  }
})();
</script>
</body>
</html>
